<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- ... (остальные meta-теги и стили остаются без изменений) ... -->
</head>
<body>
    <div class="container">
        <h1>Добро пожаловать!</h1>
        <div id="auth-button">
            <button onclick="loginWithTelegram()">Войти через Telegram</button>
        </div>
        <div id="user-info" class="user-info" style="display: none;">
            <p>Привет, <span id="username"></span>!</p>
        </div>
    </div>

    <script>
    // Проверяем, открыто ли внутри Telegram WebApp
    if (window.Telegram && Telegram.WebApp) {
        const tgUser = Telegram.WebApp.initDataUnsafe.user;
        if (tgUser) {
            showUser(tgUser.first_name || 'Пользователь');
            Telegram.WebApp.expand(); // Раскрываем Mini App на весь экран
        }
    }

    // Функция для показа данных пользователя
    function showUser(name) {
        document.getElementById('username').textContent = name;
        document.getElementById('auth-button').style.display = 'none';
        document.getElementById('user-info').style.display = 'block';
    }

    // OAuth через Telegram (кнопка "Войти")
    function loginWithTelegram() {
        const botId = "7474644739:AAE7YQNPDBmvIdOeKLrrb3j42zjvFL1w4Bs"; // Замените на ваш bot_id (цифры из @BotFather)
        const authUrl = `https://oauth.telegram.org/auth?bot_id=${botId}&origin=${encodeURIComponent(window.location.origin)}&embed=1&request_access=write`;
        
        const authWindow = window.open(authUrl, 'TelegramAuth', 'width=500,height=600');
        
        // Слушаем ответ от Telegram OAuth
        window.addEventListener('message', (event) => {
            if (event.origin !== 'https://oauth.telegram.org') return;
            
            const data = event.data;
            if (data.event === 'auth_result' && data.result === 'success') {
                const user = data.user;
                showUser(user.first_name || 'Пользователь');
                localStorage.setItem('telegram_user', JSON.stringify(user));
                
                // Закрываем окно авторизации
                if (authWindow) authWindow.close();
                
                // Если в Mini App — обновляем интерфейс
                if (window.Telegram?.WebApp) {
                    Telegram.WebApp.expand();
                }
            }
        });
    }

    // Проверяем localStorage при загрузке
    window.onload = () => {
        const savedUser = localStorage.getItem('telegram_user');
        if (savedUser) {
            const user = JSON.parse(savedUser);
            showUser(user.first_name || 'Пользователь');
        }
    };
</script>
</body>
</html>
