<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- ... (остальные meta-теги и стили остаются без изменений) ... -->
</head>
<body>
    <div class="container">
        <h1>Добро пожаловать!</h1>
        <div id="auth-button">
            <button onclick="loginWithTelegram()">Войти через Telegram</button>
        </div>
        <div id="user-info" class="user-info" style="display: none;">
            <p>Привет, <span id="username"></span>!</p>
        </div>
    </div>

    <script>
        // ===== 1. Проверка WebApp (если открыто внутри Telegram) =====
        if (window.Telegram && Telegram.WebApp) {
            const user = Telegram.WebApp.initDataUnsafe.user;
            if (user) {
                document.getElementById('username').textContent = user.first_name || 'Пользователь';
                document.getElementById('auth-button').style.display = 'none';
                document.getElementById('user-info').style.display = 'block';
            }
        }

        // ===== 2. Обычная аутентификация через OAuth =====
        function loginWithTelegram() {
            const botId = "7474644739:AAE7YQNPDBmvIdOeKLrrb3j42zjvFL1w4Bs"; // Замените на ваш цифровой bot_id
            const authUrl = `https://oauth.telegram.org/auth?bot_id=${botId}&origin=${encodeURIComponent(window.location.origin)}&embed=1&request_access=write`;
            window.open(authUrl, 'TelegramAuth', 'width=500,height=600');
            window.addEventListener('message', handleTelegramAuth);
        }

        function handleTelegramAuth(event) {
            if (event.origin !== 'https://oauth.telegram.org') return;
            
            const authData = event.data;
            if (authData.event === 'auth_result' && authData.result === 'success') {
                const user = authData.user;
                document.getElementById('username').textContent = user.first_name || 'Пользователь';
                document.getElementById('auth-button').style.display = 'none';
                document.getElementById('user-info').style.display = 'block';
                localStorage.setItem('telegram_user', JSON.stringify(user));
            }
        }

        // ===== 3. Проверка localStorage (если пользователь уже авторизован) =====
        window.onload = function() {
            const savedUser = localStorage.getItem('telegram_user');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                document.getElementById('username').textContent = user.first_name || 'Пользователь';
                document.getElementById('auth-button').style.display = 'none';
                document.getElementById('user-info').style.display = 'block';
            }
        };
    </script>
</body>
</html>
